---
import SearchForm from './SearchForm.astro';
---

<aside class="search-widget">
  <div class="search-form-header">
    <label for="searchWidget" class="search-label">Search Tweets</label>
    <span class="search-description">Enter a search term or phrase to search tweets</span>
  </div>
  <input 
    type="search" 
    required 
    min="2"
    max="100"
    name="search" 
    id="searchWidget"
    class="search-input"
    placeholder="Search tweets..." 
  />
</aside>

<script>
    import DOMPurify from 'dompurify';
    
    const searchWidget = document.querySelector('#searchWidget') as HTMLInputElement | null;
    
    searchWidget?.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            
            const searchTerm = DOMPurify.sanitize(searchWidget.value);
            console.log("Search term:", searchTerm);
            
            if (!searchTerm || searchTerm.length === 0) return;
            
            const url = new URL("/search", window.location.origin);
            url.searchParams.set("q", searchTerm);
            window.location.assign(url.toString());
        }
    });
    
    // Also handle form submission if wrapped in a form
    const form = searchWidget?.closest('form');
    form?.addEventListener('submit', (e) => {
        e.preventDefault();
        
        if (!searchWidget) return;
        
        const searchTerm = DOMPurify.sanitize(searchWidget.value);
        console.log("Search term:", searchTerm);
        
        if (!searchTerm || searchTerm.length === 0) return;
        
        const url = new URL("/search", window.location.origin);
        url.searchParams.set("q", searchTerm);
        window.location.assign(url.toString());
    });
</script>
